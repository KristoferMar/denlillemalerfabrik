{%- liquid
  assign colors = shop.metaobjects['paint_color'].values
  assign columns = section.settings.columns
  assign mobile_columns = section.settings.mobile_columns
  assign swatch_shape = section.settings.swatch_shape
  assign group_by_family = section.settings.group_by_family
-%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="
    section
    section--{{ section.settings.section_width }}
    color-{{ section.settings.color_scheme }}
    spacing-style
    gap-style
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
  "
>
  {%- if section.settings.heading != blank -%}
    <h2 class="kmeconsulting-color-grid__heading">{{ section.settings.heading }}</h2>
  {%- endif -%}

  {%- if group_by_family -%}
    {%- liquid
      assign families = ''
      for color in colors
        assign family = color.color_family | default: 'Andet'
        unless families contains family
          if families != ''
            assign families = families | append: ','
          endif
          assign families = families | append: family
        endunless
      endfor
      assign families_array = families | split: ','
    -%}

    {%- for family in families_array -%}
      <div class="kmeconsulting-color-grid__group">
        <h3 class="kmeconsulting-color-grid__family-name">{{ family }}</h3>
        <div
          class="kmeconsulting-color-grid__grid"
          style="
            --columns: {{ columns }};
            --mobile-columns: {{ mobile_columns }};
          "
        >
          {%- for color in colors -%}
            {%- liquid
              assign color_family = color.color_family | default: 'Andet'
            -%}
            {%- if color_family == family -%}
              {%- render 'kmeconsulting-color-swatch',
                color: color,
                swatch_shape: swatch_shape,
                configurator_section_id: section.settings.configurator_section_id
              -%}
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endfor -%}
  {%- else -%}
    <div
      class="kmeconsulting-color-grid__grid"
      style="
        --columns: {{ columns }};
        --mobile-columns: {{ mobile_columns }};
      "
    >
      {%- for color in colors -%}
        {%- render 'kmeconsulting-color-swatch',
          color: color,
          swatch_shape: swatch_shape,
          configurator_section_id: section.settings.configurator_section_id
        -%}
      {%- endfor -%}
    </div>
  {%- endif -%}
</div>

<style>
  .kmeconsulting-color-grid__heading {
    text-align: center;
    margin: 0;
  }

  .kmeconsulting-color-grid__group {
    width: 100%;
  }

  .kmeconsulting-color-grid__family-name {
    margin: 0 0 12px;
  }

  .kmeconsulting-color-grid__grid {
    display: grid;
    grid-template-columns: repeat(var(--mobile-columns, 3), 1fr);
    gap: 16px;
    width: 100%;
  }

  @media screen and (min-width: 750px) {
    .kmeconsulting-color-grid__grid {
      grid-template-columns: repeat(var(--columns, 6), 1fr);
    }
  }

  .kmeconsulting-color-swatch {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    transition: transform var(--hover-transition-duration, 0.25s) var(--hover-transition-timing, ease-out);
  }

  .kmeconsulting-color-swatch:hover {
    transform: scale(1.05);
  }

  .kmeconsulting-color-swatch__color {
    width: 100%;
    aspect-ratio: 1;
    border: 1px solid rgb(var(--color-foreground-rgb, 0 0 0) / 0.12);
    background-position: center;
    background-size: cover;
  }

  .kmeconsulting-color-swatch__color--circle {
    border-radius: 50%;
  }

  .kmeconsulting-color-swatch__color--square {
    border-radius: 4px;
  }

  .kmeconsulting-color-swatch__name {
    font-size: 0.8rem;
    text-align: center;
    line-height: 1.2;
    word-break: break-word;
  }

  .kmeconsulting-color-swatch--selected .kmeconsulting-color-swatch__color {
    outline: 2px solid var(--color-foreground, #000);
    outline-offset: 3px;
  }
</style>

{% schema %}
{
  "name": "Farvekatalog",
  "class": "kmeconsulting-color-grid",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Overskrift",
      "default": "Vælg en farve"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Kolonner (desktop)",
      "min": 3,
      "max": 10,
      "step": 1,
      "default": 6
    },
    {
      "type": "select",
      "id": "mobile_columns",
      "label": "Kolonner (mobil)",
      "options": [
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "swatch_shape",
      "label": "Form",
      "options": [
        {
          "value": "circle",
          "label": "Cirkel"
        },
        {
          "value": "square",
          "label": "Firkant"
        }
      ],
      "default": "circle"
    },
    {
      "type": "checkbox",
      "id": "group_by_family",
      "label": "Grupper efter farvefamilie",
      "default": false
    },
    {
      "type": "text",
      "id": "configurator_section_id",
      "label": "Konfigurator sektion-ID",
      "info": "ID'et på konfigurator-sektionen på samme side (bruges til scroll). Lad stå tom for at navigere via URL-parameter."
    },
    {
      "type": "header",
      "content": "Sektionslayout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Bredde",
      "options": [
        {
          "value": "page-width",
          "label": "Sidebredde"
        },
        {
          "value": "full-width",
          "label": "Fuld bredde"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Mellemrum",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 28
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Farveskema",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bund",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    }
  ],
  "presets": [
    {
      "name": "Farvekatalog",
      "category": "Farver"
    }
  ]
}
{% endschema %}
